# 文档 prompt

当涉及项目文档编写时，请 Agent 参考本文档中的信息，你可以将关键的指令与提示总结并输出到对话 context 中，或者提示自己在设计方案和实现时再次查阅文档，方便你在全程记住它们并依照它们行动。

# 文档结构

项目有很多类型的文档，分别位于项目不同的地方。

- 文档网站：位于主仓库 `website` 目录下，管理 Crater 相关的部署、用户和管理员文档，提供给选择 Crater 项目的用户或集群管理员
- 开发/维护文档：各个仓库的 README 以及主仓库的 `docs` 目录，保存 Crater 相关的开发和维护文档，提供给 Crater 的开发者和维护人员

# 注意事项（提示词）

这章对于 Agent 非常关键，请在整个文档完成流程中牢记以下提示，如有需要，请你以便于你在整个会话中保持长期记忆的方式输出它们，或者提示自己在需要时再次查阅文档。

## 整体

- 不要写流水账式的文档，不能仅仅列举并解释代码，需要讲清楚人类开发者或者维护成员为什么要这样设计，保持思路的连贯性
- 思考何时需要总结，何时需要列举
- 当需要你补充文档内容时，你必须完整的阅读文档，并思考将新内容添加在哪里合适，而不是单独添加一个新的章节来写补充信息
- 对于很多东西，讲清楚它们的输入输出非常关键，这能在极大程度上帮助读者理解它
- 如果你不确定某些信息或不确定该如何做，包括以上让你思考的问题，你可以询问用户，或是输出你的推测，让用户进行确认

## 具体

- 如果在指令中，用户要求你“优化表述”，你需要检查专业用语的准确性，语法的正确性以及寓意的连贯性

# 样例

这一部分将提供一些不好的样例和按照用户要求修改后的样例，你可以从中学习用户偏好。

### 1

有待改进的版本：
```
Crater 项目的 CI 流程基于 GitHub Actions 构建，主要服务于代码质量保障和构建产物发布。与传统的 CI/CD 流程不同，我们仅保留了持续集成（CI）部分，将持续部署（CD）交由用户根据自身环境自行处理。这样的设计既保证了代码质量和构建产物的标准化，又给予了用户部署的灵活性。
```

更符合预期的版本：
```
Crater 项目的 CI 流程基于 GitHub Actions 构建，主要服务于代码质量保障和构建产物发布。与传统的 CI/CD 流程不同，我们仅保留了持续集成（CI）部分，将持续部署（CD）交由用户根据自身环境自行处理。
```

解释：
- 不需要在段落最后添加这种极其基本的总结或评价，十分多余，大多读者都能立刻领悟到这层意识，如果你觉得有些内容比较特殊，也可以添加

### 2

有待改进的版本：
```
## 前端与后端

### 总体设计

前端与后端的 CI 流程采用两阶段设计：PR 检查阶段和构建发布阶段。这种设计将代码质量保障与构建发布分离，既保证了主分支代码质量，又避免了不必要的构建开销。

PR 检查阶段在代码合并前执行，主要目的是防止坏代码进入主分支。当开发者提交 Pull Request 时，CI 会自动触发代码风格检查（Lint）和构建验证（Build Check）。对于 Go 项目（Backend 和 Storage），使用 golangci-lint 进行代码检查，并验证代码能够成功编译；对于前端项目（Frontend），使用 ESLint 进行代码检查，并验证项目能够成功构建。为了减少构建时间，PR 检查阶段只构建单平台（linux/amd64）的二进制文件或前端资源，不推送镜像。如果检查失败，PR 无法合并，从而确保主分支代码质量。

构建发布阶段在代码合并到主分支或创建版本标签时执行，主要目的是构建和发布可用的镜像。该阶段会重新执行代码检查和构建验证，然后构建多平台镜像（linux/amd64 和 linux/arm64）并推送到 GHCR。多平台支持使得镜像可以在不同架构的服务器上运行，满足不同硬件环境的需求。构建完成后，CI 会自动清理旧镜像，控制存储空间。

Backend、Frontend 和 Storage 三个组件采用相同的 CI 模式，但构建过程略有不同。Backend 和 Storage 作为 Go 项目，需要编译生成二进制文件，然后打包到 Docker 镜像中；Frontend 作为前端项目，需要构建静态资源，然后通过 Nginx 等 Web 服务器提供服务的镜像。尽管构建过程不同，但都遵循相同的两阶段设计，确保了一致的代码质量标准和发布流程。
```

更符合预期的版本：
```
## 前端与后端

### 总体设计

前端与后端的 CI 流程采用两阶段设计：PR 检查阶段和构建发布阶段。输入为源代码（Go 代码或前端资源），输出为多平台 Docker 镜像（linux/amd64 和 linux/arm64），产物保存在 GHCR 的 `ghcr.io/raids-lab/crater-backend`、`ghcr.io/raids-lab/crater-frontend` 和 `ghcr.io/raids-lab/storage-server` 仓库中。

PR 检查阶段在代码合并前执行，进行代码风格检查（Lint）和构建验证，只构建单平台以节省时间，不构建和推送镜像。构建发布阶段在代码合并后或创建版本标签时执行，构建多平台镜像并推送到 GHCR，同时自动清理旧镜像以控制存储空间。

Backend、Frontend 和 Storage 三个组件采用相同的两阶段 CI 模式，但构建过程不同：Backend 和 Storage 编译生成二进制文件后打包到镜像中，Frontend 构建静态资源后通过 Web 服务器提供服务的镜像。
```

解释：
- 清楚的讲明白了输入输出，帮助用户理解
- 对于概述或者总体设计，不需要过多的体现细节，后续文档将会有具体说明

### 3

有待改进的版本：

```
## 前端与后端

### 概述

### 前端 PR Check

### 前端 Build

### 后端 PR Check

### 后端 Build
```

更符合预期的版本：

```
## 前端与后端

### 概述

### 触发与版本管理

### 版本号注入

### 跨平台构建

### 镜像推送与清理

### PR Check
```

解释：

- 相比于从代码的角度逐个解释，从逻辑的角度解释更容易理解 
